<!doctype html>
<html lang="en">
  <head>
    <link rel="icon" type="image/png" sizes="192x192" href="{{ app.router.static.url(filename='img/ant_army_logo_2.png') }}" />
    <!--<meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no" />-->
    <link rel="stylesheet" href="{{ app.router.static.url(filename='node_modules/spectre.css/dist/spectre.min.css') }}" />
    <link rel="stylesheet" href="{{ app.router.static.url(filename='node_modules/font-awesome/css/font-awesome.min.css') }}" />
    <link rel="stylesheet" href="{{ app.router.static.url(filename='node_modules/d3.parcoords.js/d3.parcoords.css') }}" />
    <link rel="stylesheet" href="{{ app.router.static.url(filename='css/army-ant.css') }}" />

    <script type="text/javascript" src="{{ app.router.static.url(filename='node_modules/d3.parcoords.js/node_modules/d3/d3.min.js')}}"></script>
    <script type="text/javascript" src="{{ app.router.static.url(filename='node_modules/d3.parcoords.js/d3.parcoords.js')}}"></script>
    <script type="text/javascript" src="{{ app.router.static.url(filename='js/util.js')}}"></script>
    <script type="text/javascript" src="{{ app.router.static.url(filename='js/visualization/score_components.js')}}"></script>
    
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
      });
    </script>

    <script type="text/javascript" async
      src="{{ app.router.static.url(filename='node_modules/mathjax/MathJax.js') }}?config=TeX-MML-AM_CHTML">
    </script>

    <title>{{ query if query }} {% if query %} - {% endif %} Army ANT</title>
  </head>
  <body>
    <div class="container grid-960">
      <div class="columns">
        <div class="column col-2">
          <a class="logo centered" href="."></a>
        </div>
        <div class="column col-10">
          <h1 class="header">
            Army ANT
            <small>
              The altruistic ant
              <a class="tooltip tooltip-right" href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4320217/" target="_blank" data-tooltip="Why Army ANT?">
                <i class="fa fa-link"></i>
              </a>
            </small>
          </h1>
        </div>
      </div>

      <form class="form-horizontal">
        <div class="form-group">
          <div class="column col-6">
            <!-- form input control -->
            <div class="input-group">
              <input class="form-input input-lg" type="text" id="query" name="query" placeholder="Search" value="{{ query if query }}" />
              <button class="btn btn-primary btn-lg input-group-btn">Search</button>
            </div>
          </div>

          <div class="column col-3">
            <!-- form radio control -->
            <select class="form-select select-lg" id="engine" name="engine">
              {% for app_engine in app.engines %}
              <option value="{{app_engine}}" {% if engine == app_engine %} selected="selected" {% endif %}>{{app.engines[app_engine].name}}</option>
              {% endfor %}
            </select>
          </div>

          <div class="column col-3">
            <!-- form switch control -->
            <label class="form-switch switch-lg">
              <input type="checkbox" id="debug" name="debug" {% if debug == 'on' %} checked="checked" {% endif %}/>
              <i class="form-icon"></i> Learn mode
            </label>
          </div>
        </div>
      </form>

      {% if results|length > 0 %}

      {% if debug == 'on' %}
      {% if engine in ['gow', 'goe'] %}
      <div id="score-components-plot" class="parcoords"></div>
      {% endif %}

      {% if engine == 'gow' %}
      <dl>
        <dt>TW-IDF</dt>
        <dd>
          TW-IDF is calculated using the indegree of the nodes that match each query term in the graph-of-word for each document as the term weight (TW). The formula used is the following:

          $$TW\text{-}IDF(q, d) = \sum_{t \in q}^d \left( \frac{tw(t, d)}{1 - b + b \times \frac{|d|}{avdl}} \times log \frac{N + 1}{df(t)} \right)$$

          Where:
          <ul>
            <li>$b = 0.003$,</li>
            <li>$tw(t, d)$ is the indegree of the node for term $t$, in the graph-of-word, for document $d$,</li>
            <li>$|d|$ is the document length,</li>
            <li>$avdl$ is the average document length for the whole corpus,</li>
            <li>$N$ is the size of the corpus,</li>
            <li>$df(t)$ is the document frequency of term $t$, i.e. the number of documents that contain term $t$.</li>
          </ul>
        </dd>

        <dt>Doc ID</dt>
        <dd>Doc ID can be a number or a string, but it must be a unique identifier for documents (e.g. a URI).</dd>
      </dl>

      <br>

      <blockquote>
        <p>Fran√ßois Rousseau and Michalis Vazirgiannis. 2013. Graph-of-word and TW-IDF: new approach to ad hoc IR. In Proceedings of the 22nd ACM international conference on Information &amp; Knowledge Management (CIKM '13). ACM, New York, NY, USA, 59-68. DOI=http://dx.doi.org/10.1145/2505515.2505671</p>
        <cite><a href="http://dl.acm.org/citation.cfm?id=2505671" target="_blank">ACM Digital Library</a></cite>
      </blockquote>
      
      <br>

      {% endif %}
      {% endif %}

      <table class="table table-striped table-hover">
        <thead>
          <tr>
            {% if debug == 'on' %}
            
            {% if engine == 'gow' %}
            <th>TW-IDF(q, d)</th>
            {% elif engine == 'goe' %}
            <th>NW-IDF(q, d)</th>
            {% else %}
            <th>Score(q, d)</th>
            {% endif %}

            <th>Doc ID</th>

            {% else %}

            <th>Image</th>
            <th>Document</th>

            {% endif %}
          </tr>
        </thead>
        <tbody>
          {% for result in results %}

          {% if debug == 'on' %}
          
          <tr>
            <td class="text-right"> {{ '%f' % result.score|float }} </td>
            <td>{{ result.docID }}</td>
          </tr>
          
          {% else %}

          <tr>
            {% if result.docID in metadata %}

            <td> <div class="image" style="background-image: url('{{
                metadata[result.docID].img_url or app.router.static.url(filename='img/thumbnail_placeholder.png') }}')"></div> </td>
            <td> <a href="{{ metadata[result.docID].url }}" target="_blank">{{ metadata[result.docID].name }}</a> </td>
            
            {% else %}
            
            <td> <div class="image" style="background-image: url('{{
                app.router.static.url(filename='img/thumbnail_placeholder.png') }}')"></div> </td>
            <td> <a href="{{ result.docID if result.docID.startswith('http') else '#' }}" target="_blank">{{ result.docID }}</a> </td>
            
            {% endif %}
          </tr>

          {% endif %}

          {% endfor %}
        </tbody>
      </table>

      {% if offset is not none %}
      {% set border_pages = 2 %}

      <ul class="pagination" style="justify-content: center">
        <li class="page-item">
          <a href="{{ page_link(page-1, limit) }}" {% if offset == 0 %} disabled tabindex="-1" {% endif %} }}>Previous</a>
        </li>

        {% if page-border_pages > 1 %}
        <li class="page-item">
          <a href="{{ page_link(1, limit) }}">1</a>
        </li>
        {% endif %}

        {% if page-border_pages > 2 %}
        <li class="page-item">
          <span>...</span>
        </li>
        {% endif %}

        {% for p in range(page-border_pages if page-border_pages > 0 else 1, (page+border_pages if page+border_pages <= pages else pages)+1) %}
        {% if p == page %}
        
        <li class="page-item active">
          <a href="#">{{p}}</a>
        </li>
        
        {% else %}
        
        <li class="page-item">
          <a href="{{ page_link(p, limit) }}">{{p}}</a>
        </li>
        
        {% endif %}
        {% endfor %}

        {% if pages > page+border_pages+1 %}
        <li class="page-item">
          <span>...</span>
        </li>
        {% endif %}
        
        {% if pages > page+border_pages %}
        <li class="page-item">
          <a href="{{ page_link(pages, limit) }}">{{pages}}</a>
        </li>
        {% endif %}
        
        <li class="page-item">
          <a href="{{ page_link(page+1, limit) }}" {% if page == pages %} disabled tabindex="-1" {% endif %}>Next</a>
        </li>
      </ul>
      {% endif %}

      {% elif error %}

      <div class="toast toast-danger message">
        <b>Error:</b> {{ error }}
      </div>

      {% else %}

      {% if query %}
      <h3 class="message">
        No results found.
      </h3>
      {% else %}
      <h3 class="message">
        Please insert a query in order to search for people in Wikipedia.
        <small>You can also select a different search engine or enable/disable debug mode.</small>
      </h3>
      {% endif %}

      {% endif %}

      <br>
      <br>
    </div>

    <script type="text/javascript">
      (function() {
        document.getElementById("query").focus();
        visScoreComponents = new ScoreComponents(ScoreComponents.resultsToComponents({{ results }}), '#score-components-plot');
        visScoreComponents.render();
      })();
    </script>
  </body>
</html>
