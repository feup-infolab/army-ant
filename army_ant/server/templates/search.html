{% extends "home.html" %}
{% block title %}
<title>{{ query if query }} {% if query %} - {% endif %} Army ANT</title>
{% endblock %}

{% set border_pages = 2 %}
{% set index_type = engine.split('-')[0] %}
{% set dataset = engine.split('-')[1] %}

{% block content %}
<form class="form-horizontal">
  <div class="form-group">
    <div class="column col-5">
      <!-- form input control -->
      <div class="input-group">
        <input class="form-input" type="text" id="query" name="query" placeholder="Search" value="{{ query if query }}" />
        <button class="btn btn-primary btn input-group-btn">Search</button>
      </div>
    </div>

    <div class="column col-4">
      <!-- form radio control -->
      <select class="form-select" id="engine" name="engine">
        {% for app_engine in app.engines %}
        <option value="{{app_engine}}" {% if engine == app_engine %} selected="selected" {% endif %}>
          {{app.engines[app_engine].name}}
        </option>
        {% endfor %}
      </select>
    </div>

    <div class="column col-3">
      <!-- form switch control -->
      <label class="form-switch">
        <input type="checkbox" id="debug" name="debug" {% if debug == 'on' %} checked="checked" {% endif %}/>
        <i class="form-icon"></i> Learn mode
      </label>
    </div>
  </div>
</form>

{% if results|length > 0 %}


<div class="container">
  <small>{{ numDocs }} results ({{ time|round(2) }} seconds)</small>
</div>

<br>

{% if debug == 'on' %}

{% include 'search/debug.html' %}

{% else %}

{% include 'search/results.html' %}

{% if offset is not none and pages > 1 %}
{% include 'search/paginator.html' %}
{% endif %}

{% endif %}


{% elif error %}


<div class="container">
  <div class="empty">
    <div class="empty-icon">
      <i class="icon icon-2x icon-stop"></i>
    </div>
    <h4 class="empty-title">Error</h4>
    <p class="empty-subtitle">{{ error }}</p>
  </div>
</div>


{% else %}


<div class="container">
  {% if query %}
  <div class="empty">
    <div class="empty-icon">
      <i class="icon icon-2x icon-search"></i>
    </div>
    <h4 class="empty-title">No results found</h4>
    <p class="empty-subtitle">Try to search for something else.</p>
  </div>
  {% else %}
  <div class="empty">
    <div class="empty-icon">
      <i class="icon icon-2x icon-search"></i>
    </div>
    <h4 class="empty-title">Please insert a query in order to search for documents/entities.</h4>
    <p class="empty-subtitle">
      <b>You can also select a different engine or enable/disable learn mode.</b> If
      there are no engines available in the drop down, please implement your own
      first and index your document collection.
    </p>
  </div>
  {% endif %}
</div>


{% endif %}

<br>
<br>

<script type="text/javascript">
  (function() {
    document.getElementById("query").focus();

    $('#learn .tab-item:first-child').addClass('active');
    $('#learn .tab-content:first-child').removeClass('d-hide');
    
    $('#learn .tab-item a').on('click', function(e) {
      $('#learn .tab-item').removeClass('active');
      $(this).parent('.tab-item').addClass('active');
      var tabContentID = $(this).attr('href');
      $('.tab-content').addClass('d-hide');
      $(tabContentID).removeClass('d-hide');
      return false;
    });

    var visScoreComponents = new ScoreComponents({{ results }}, '#score-components-plot');
    visScoreComponents.render();
  })();
</script>
{% endblock %}
