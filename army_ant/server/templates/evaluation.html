{% extends "home.html" %}
{% block title %}
<title>Evaluation - Army ANT</title>
{% endblock %}

{% block content %}
<div class="columns">
  <div class="column col-12">
    <header>
      <h3>Evaluation</h3>
    </header>

    <form method="post" accept-charset="utf-8" enctype="multipart/form-data">
      <div class="columns">
        <div class="column">
          <div class="form-group">
            <label class="form-label" for="topics">Topics</label>
            <input class="form-input" type="file" id="topics" name="topics" value="">
          </div>
        </div>
        <div class="column">
          <div class="form-group">
            <label class="form-label" for="assessments">Assessments</label>
            <input class="form-input" type="file" id="assessments" name="assessments" value="">
          </div>
        </div>
      </div>

      <div class="columns">
        <div class="column">
          <div class="form-group">
            <label class="form-label" for="eval-format">Evaluator Format</label>
            <select class="form-select select-lg" id="eval-format" name="eval-format">
              <option value="inex">INEX</option>
            </select>
          </div>
        </div>

        <div class="column">
          <div class="form-group">
            <label class="form-label" for="topics">Search Engine</label>
            <select class="form-select select-lg" id="engine" name="engine">
              {% for app_engine in app.engines %}
              <option value="{{app_engine}}">{{ app.engines[app_engine].name }}</option>
              {% endfor %}
              <option value="__all__">All Engines</option>
            </select>
          </div>
        </div>
      </div>

      <br>

      <div class="form-group">
        <button class="btn btn-primary btn-lg" type="submit">Launch assessment</button>
        <button class="btn btn-lg" type="reset">Clear form</button>
      </div>
    </form>
  </div>
</div>

<div class="divider"></div>

<div class="columns">
  <div class="column">
    <header>
      <h3>Tasks</h3>
    </header>

    {% if tasks|length > 0 %}
    
    <table class="table">
      <thead>
        <th>Queued</th>
        <th>Topics</th>
        <th>Assessments</th>
        <th>Index</th>
        <th>Status</th>
      </thead>

      <tbody>
        {% for task in tasks %}
        <tr {% if task._id %} data-id="{{ task._id }}" {% endif %}>
          <td>{{ task.time|timestamp_to_date }}</td>
          <td>{{ task.topics_filename}}</td>
          <td>{{ task.assessments_filename }}</td>
          <td>{{ task.index_location }} ({{ task.index_type }})</td>
          {% if task.status == 3 %}
          <td><a href="{{ app.router['evaluation_results'].url() + '?task_id=' + task._id }}">{{ task.status.name }}</a></td>
          {% else %}
          <td>{{ task.status.name }}</td>
          {% endif %}
        {% endfor %}
      </tbody>
    </table>

    {% else %}

    <div class="empty">
      <div class="empty-icon">
        <i class="icon icon-menu"></i>
      </div>
      <h4 class="empty-title">No evaluation tasks found</h4>
      <p class="empty-subtitle">Try to launch your own using the formulary above.</p>
    </div>

    {% endif %}
  </div>
</div>

<div class="divider"></div>

<div class="columns">
  <div class="column">
    <header>
      <h3>Results</h3>
    </header>

    {% if results|length > 0 %}

    {% else %}

    <div class="empty">
      <div class="empty-icon">
        <i class="icon icon-menu"></i>
      </div>
      <h4 class="empty-title">No evaluation results found</h4>
      <p class="empty-subtitle">Results will be displayed here after evaluation tasks are finished.</p>
    </div>

    {% endif %}
  </div>
</div>

{% if error %}
<script type="text/javascript">
  (function() {
    $('#error .message').text('{{ error }}');
    $('#error').removeClass('hide');
  })();
</script>
{% endif %}

{% endblock %}
